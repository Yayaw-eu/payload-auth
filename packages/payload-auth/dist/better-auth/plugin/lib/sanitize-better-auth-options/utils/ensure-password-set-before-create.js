/**
 * Adds a before hook to the user create operation to ensure the password is set.
 * This is necessary because the password is not set in the user create operation
 * and is instead set in the sync password accounts hook.
 */ export function ensurePasswordSetBeforeUserCreate(options) {
    if (typeof options.databaseHooks !== 'object') options.databaseHooks = {};
    if (typeof options.databaseHooks.user !== 'object') options.databaseHooks.user = {};
    if (typeof options.databaseHooks.user.create !== 'object') options.databaseHooks.user.create = {};
    const initialBeforeUserCreateHook = options.databaseHooks.user.create.before ?? null;
    options.databaseHooks.user.create.before = async (user, ctx)=>{
        if (!user.password) {
            ;
            user.password = ctx?.body?.password ?? Array(3).fill(0).map(()=>Math.random().toString(36).slice(2)).join('');
        }
        if (typeof initialBeforeUserCreateHook === 'function') {
            return initialBeforeUserCreateHook(user, ctx);
        }
        return {
            data: user
        };
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9iZXR0ZXItYXV0aC9wbHVnaW4vbGliL3Nhbml0aXplLWJldHRlci1hdXRoLW9wdGlvbnMvdXRpbHMvZW5zdXJlLXBhc3N3b3JkLXNldC1iZWZvcmUtY3JlYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgU2FuaXRpemVkQmV0dGVyQXV0aE9wdGlvbnMgfSBmcm9tICdAL2JldHRlci1hdXRoL3BsdWdpbi90eXBlcydcblxuLyoqXG4gKiBBZGRzIGEgYmVmb3JlIGhvb2sgdG8gdGhlIHVzZXIgY3JlYXRlIG9wZXJhdGlvbiB0byBlbnN1cmUgdGhlIHBhc3N3b3JkIGlzIHNldC5cbiAqIFRoaXMgaXMgbmVjZXNzYXJ5IGJlY2F1c2UgdGhlIHBhc3N3b3JkIGlzIG5vdCBzZXQgaW4gdGhlIHVzZXIgY3JlYXRlIG9wZXJhdGlvblxuICogYW5kIGlzIGluc3RlYWQgc2V0IGluIHRoZSBzeW5jIHBhc3N3b3JkIGFjY291bnRzIGhvb2suXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbnN1cmVQYXNzd29yZFNldEJlZm9yZVVzZXJDcmVhdGUob3B0aW9uczogU2FuaXRpemVkQmV0dGVyQXV0aE9wdGlvbnMpIHtcbiAgaWYgKHR5cGVvZiBvcHRpb25zLmRhdGFiYXNlSG9va3MgIT09ICdvYmplY3QnKSBvcHRpb25zLmRhdGFiYXNlSG9va3MgPSB7fVxuICBpZiAodHlwZW9mIG9wdGlvbnMuZGF0YWJhc2VIb29rcy51c2VyICE9PSAnb2JqZWN0Jykgb3B0aW9ucy5kYXRhYmFzZUhvb2tzLnVzZXIgPSB7fVxuICBpZiAodHlwZW9mIG9wdGlvbnMuZGF0YWJhc2VIb29rcy51c2VyLmNyZWF0ZSAhPT0gJ29iamVjdCcpIG9wdGlvbnMuZGF0YWJhc2VIb29rcy51c2VyLmNyZWF0ZSA9IHt9XG4gIGNvbnN0IGluaXRpYWxCZWZvcmVVc2VyQ3JlYXRlSG9vayA9IG9wdGlvbnMuZGF0YWJhc2VIb29rcy51c2VyLmNyZWF0ZS5iZWZvcmUgPz8gbnVsbFxuXG4gIG9wdGlvbnMuZGF0YWJhc2VIb29rcy51c2VyLmNyZWF0ZS5iZWZvcmUgPSBhc3luYyAodXNlciwgY3R4KSA9PiB7XG4gICAgaWYgKCEodXNlciBhcyBhbnkpLnBhc3N3b3JkKSB7XG4gICAgICA7KHVzZXIgYXMgYW55KS5wYXNzd29yZCA9XG4gICAgICAgIGN0eD8uYm9keT8ucGFzc3dvcmQgPz9cbiAgICAgICAgQXJyYXkoMylcbiAgICAgICAgICAuZmlsbCgwKVxuICAgICAgICAgIC5tYXAoKCkgPT4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMikpXG4gICAgICAgICAgLmpvaW4oJycpXG4gICAgfVxuICAgIGlmICh0eXBlb2YgaW5pdGlhbEJlZm9yZVVzZXJDcmVhdGVIb29rID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gaW5pdGlhbEJlZm9yZVVzZXJDcmVhdGVIb29rKHVzZXIsIGN0eClcbiAgICB9XG4gICAgcmV0dXJuIHsgZGF0YTogdXNlciB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJlbnN1cmVQYXNzd29yZFNldEJlZm9yZVVzZXJDcmVhdGUiLCJvcHRpb25zIiwiZGF0YWJhc2VIb29rcyIsInVzZXIiLCJjcmVhdGUiLCJpbml0aWFsQmVmb3JlVXNlckNyZWF0ZUhvb2siLCJiZWZvcmUiLCJjdHgiLCJwYXNzd29yZCIsImJvZHkiLCJBcnJheSIsImZpbGwiLCJtYXAiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImpvaW4iLCJkYXRhIl0sIm1hcHBpbmdzIjoiQUFFQTs7OztDQUlDLEdBQ0QsT0FBTyxTQUFTQSxrQ0FBa0NDLE9BQW1DO0lBQ25GLElBQUksT0FBT0EsUUFBUUMsYUFBYSxLQUFLLFVBQVVELFFBQVFDLGFBQWEsR0FBRyxDQUFDO0lBQ3hFLElBQUksT0FBT0QsUUFBUUMsYUFBYSxDQUFDQyxJQUFJLEtBQUssVUFBVUYsUUFBUUMsYUFBYSxDQUFDQyxJQUFJLEdBQUcsQ0FBQztJQUNsRixJQUFJLE9BQU9GLFFBQVFDLGFBQWEsQ0FBQ0MsSUFBSSxDQUFDQyxNQUFNLEtBQUssVUFBVUgsUUFBUUMsYUFBYSxDQUFDQyxJQUFJLENBQUNDLE1BQU0sR0FBRyxDQUFDO0lBQ2hHLE1BQU1DLDhCQUE4QkosUUFBUUMsYUFBYSxDQUFDQyxJQUFJLENBQUNDLE1BQU0sQ0FBQ0UsTUFBTSxJQUFJO0lBRWhGTCxRQUFRQyxhQUFhLENBQUNDLElBQUksQ0FBQ0MsTUFBTSxDQUFDRSxNQUFNLEdBQUcsT0FBT0gsTUFBTUk7UUFDdEQsSUFBSSxDQUFDLEFBQUNKLEtBQWFLLFFBQVEsRUFBRTs7WUFDekJMLEtBQWFLLFFBQVEsR0FDckJELEtBQUtFLE1BQU1ELFlBQ1hFLE1BQU0sR0FDSEMsSUFBSSxDQUFDLEdBQ0xDLEdBQUcsQ0FBQyxJQUFNQyxLQUFLQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxLQUFLLENBQUMsSUFDM0NDLElBQUksQ0FBQztRQUNaO1FBQ0EsSUFBSSxPQUFPWixnQ0FBZ0MsWUFBWTtZQUNyRCxPQUFPQSw0QkFBNEJGLE1BQU1JO1FBQzNDO1FBQ0EsT0FBTztZQUFFVyxNQUFNZjtRQUFLO0lBQ3RCO0FBQ0YifQ==